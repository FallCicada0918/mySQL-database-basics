

# MySQL作业

## 数据库概述

### **1、什么是数据库？请简要描述数据库的定义和作用。**



### **2、什么是关系型数据库？关系型数据库中的"关系"体现在哪些方面？**



### **3、说说你对DB、DBMS、SQL的理解**



### **4、常见的数据库对象有哪些，列出3个并简述一下其在数据库中的作用**





## 用户与建库

### **1、创建一个MySQL用户`briup`，并给其赋予权限**

1）以具有足够权限的用户身份登录到 MySQL 服务器

```sql
-- 使用root用户登录


-- 输入密码成功登录

```



2）创建用户（briup)，并为其分配密码

```mysql

```



3） 根据需要赋予用户授予用户适当的权限

-  授予用户对所有数据库的全部权限

```sql

```

-  授予用户对指定数据库(如：estore)的全部权限

```sql

```

-  授予用户对指定数据库(如：estore)的读写权限

```sql

```



4）在完成权限授予后，使用以下命令刷新 MySQL 权限，以确保新权限生效

```sql

```



### **2、创建一个数据库`test`，并指定其编码格式为utf8mb4**

1）以具有足够权限的用户身份登录到 MySQL 服务器

```sql
-- 使用root用户登录


-- 输入密码成功登录

```



2）创建数据库并切换到该数据库

```sql
-- 创建一个名为 `test` 的数据库，要求如下：
-- 1.并将其字符集设置为 `utf8mb4`
-- 2.排序规则设置为 `utf8mb4_unicode_ci`


-- 切换到 test数据库中

```





## 基础DQL

### **1、现有一份sql脚本，如何将其导入到MySQL数据库中**

> sql脚本文件为230705-estore.sql文件
> <img src=".\assets\image-20230706144244206.png" alt="image-20230706144244206" style="zoom: 40%;" />

要将 SQL 脚本导入到 MySQL 数据库中，操作步骤如下：

1）确保你具有足够的权限以导入数据到目标数据库。通常，你需要具有 `CREATE` 和 `INSERT` 表的权限

可以使用root用户登录到数据库后导入数据



2）打开命令行终端或使用图形界面工具（如 phpMyAdmin、Navicat 等）连接到 MySQL 数据库服务器

```sql
-- 使用root用户登录


-- 输入密码成功登录

```



3） 创建目标数据库（如果尚未存在），可以使用以下命令创建数据库

```sql

```



4）选择要使用的数据库

```sql

```



5） 执行 SQL 脚本以导入数据。在命令行终端中，可以使用以下命令

```sql

```



6） 等待导入过程完成




### 2、请在上述导入的数据基础上，完成以下操作

1）查询图书表中所有图书的名称和作者

```sql

```



2）查询图书表中出版社，并且保证结果不重复

```sql

```



3）查询图书表中图书的售价大于等于30的图书名称和作者

```sql

```



4）查询图书表中出版社为"上海文艺出版社"的图书信息

```sql

```



5）查询图书表中图书作者为"briup"并且库存数量大于0的图书名称和库存数量

```sql

```



6）查询图书表中库存数量为空（NULL）的图书名称。

```sql

```



7）查询图书表中名称包含关键字"入门"的图书名称和作者。

```sql

```



8）查询图书表中图书出版社在"机械工业出版社"或"北京教育出版社"的图书名称和作者

```sql

```





## 运算与分页

### **1、根据上述表及数据完成下列操作**

1）查询图书表中售价最高的图书名称、作者和售价。

```sql

```




2）查询图书表中库存数量为空或售价为零的图书名称和作者。

```sql

```



3）查询图书表图书名称和作者，并且以作者升序排序，作者相同则按照书名降序排序。

```sql

```




4）查询图书表中价格最高的前3本图书的名称和作者

```sql

```



5）查询图书表中第2页的图书名称和作者，每页显示2条记录，按照图书ID进行升序排序。

```sql

```




### **2、请执行以下sql语句，完成下列要求**

```mysql
-- 新建数据库,并切换数据库
CREATE DATABASE test;
USE test;

-- 建表
CREATE TABLE student_scores (
  id INT PRIMARY KEY,
  name VARCHAR(50) NOT NULL,
  math_score INT,
  physics_score INT,
  chemistry_score INT,
);

-- 插入数据
INSERT INTO student_scores (id, name, math_score, physics_score, chemistry_score)
VALUES
  (1, 'Alice', 85, 90, 92),
  (2, 'Bob', 78, 85, 80),
  (3, 'Charlie', NULL, 88, 95),
  (4, 'David', 75, 82, 78),
  (5, 'Emma', 90, 92, 88),
  (6, 'Frank', 85, NULL, 86),
  (7, 'Grace', 95, 88, 90),
  (8, 'Henry', 78, 85, 80),
  (9, 'Ivy', 92, 90, 95),
  (10, 'Jack', 82, 78, NULL);
```

数据字典：

| 字段名          | 数据类型    | 约束类型    | 备注     |
| --------------- | ----------- | ----------- | -------- |
| id              | INT         | PRIMARY KEY | 主键     |
| student_name    | VARCHAR(50) | NOT NULL    | 学生姓名 |
| math_score      | INT         |             | 数学成绩 |
| physics_score   | INT         |             | 物理成绩 |
| chemistry_score | INT         |             | 化学成绩 |



1）查询所有学生的总成绩，如果某门成绩为 NULL，则将其视为 0

```sql

```



2）查询数学成绩大于等于90分的学生姓名和数学成绩

```sql

```



3）查询物理成绩为空或化学成绩小于80分的学生姓名和对应科目的成绩

```sql

```



4）查询平均成绩大于等于85分的学生姓名和平均成绩，如果某门成绩为 NULL，则将其视为 0

```sql

```



5）查询总分最高的学生信息

```sql

```





## 多表查询

> 请已有的estore数据库中执行下列sql语句：

```sql
-- 添加10条数据到es_address表
INSERT INTO es_address (id, receiver_name, urban_addr, detail_addr, phone, user_id)
VALUES
  (6, '赵', '江苏省南京市鼓楼区', '中山南路123号', '13800010006', 3),
  (7, '王五', '江苏省苏州市相城区', '太湖大道999号', '13800010007', 2),
  (8, '刘六', '广东省深圳市南山区', '科技园大道123号', '13800010008', 4),
  (9, '陈七', '北京市朝阳区', '建国路123号', '13800010009', 1),
  (10, '杨八', '浙江省杭州市西湖区', '文二路888号', '13800010010', 5);

-- 修改数据
update es_book set store_num = 100 where id = 6;

-- 添加10条数据到es_book表
INSERT INTO es_book (id, name, cover, description, author, publisher, price, store_num, status, category_id)
VALUES
  (7, 'C++ Primer', NULL, 'C++语言入门教程', 'Stanley B. Lippman', '机械工业出版社', 49.90, 100, 0, 5),
  (8, 'JavaScript高级程序设计', NULL, 'JavaScript编程指南', 'Nicholas C. Zakas', '机械工业出版社', 59.90, 200, 0, 5),
  (9, '数据结构与算法', NULL, '数据结构与算法入门', 'Thomas H. Cormen', '机械工业出版社', 39.90, 150, 0, 7),
  (10, '红楼梦', NULL, '中国古代四大名著之一', '曹雪芹', '上海文艺出版社', 42.90, 100, 0, 2),
  (11, '西游记', NULL, '中国古代四大名著之一', '吴承恩', '上海文艺出版社', 42.90, 100, 0, 2),
  (12, '三国演义', NULL, '中国古代四大名著之一', '罗贯中', '上海文艺出版社', 42.90, 100, 0, 2),
  (13, '数据挖掘导论', NULL, '数据挖掘入门教程', 'Jiawei Han', '机械工业出版社', 49.90, 100, 0, 7),
  (14, '计算机网络', NULL, '计算机网络基础知识', 'Andrew S. Tanenbaum', '机械工业出版社', 39.90, 150, 0, 5),
  (15, '论语', NULL, '中国古代经典著作', '孔子', '北京教育出版社', 19.90, 200, 0, 8),
  (16, '大学语文', NULL, '大学语文课程教材', '佚名', '北京教育出版社', 29.90, 150, 0, 8);
 
 -- 添加10条数据到es_category表
INSERT INTO es_category (id, name, description, parent_id)
VALUES
  (9, '经济学', '经济学大类', NULL),
  (10, '金融学', '经济学子类1', 9),
  (11, '管理学', '经济学子类2', 9),
  (12, '法学', '法学大类', NULL),
  (13, '刑法学', '法学子类1', 12),
  (14, '民法学', '法学子类2', 12),
  (15, '外国语', '外语大类', NULL),
  (16, '英语', '外语子类1', 15),
  (17, '法语', '外语子类2', 15),
  (18, '心理学', '心理学大类', NULL);

-- 添加11条数据到es_shopcar表
INSERT INTO es_shopcar (id, user_id, book_id, num)
VALUES
  (7, 1, 5, 2),
  (8, 2, 1, 1),
  (9, 2, 2, 1),
  (10, 3, 3, 2),
  (11, 4, 4, 1),
  (12, 4, 5, 3),
  (13, 5, 3, 1),
  (14, 5, 4, 2),
  (15, 1, 6, 1),
  (16, 2, 7, 1),
  (17, 5, 8, 1);

```



### **1、请根据上述表与数据完成下列操作**

1）查询所有图书分类及其父分类名称

```sql

```



2） 查询图书分类为 "小说" 的图书名称、价格和出版社

```sql

```



3） 查询下单客户ID为 4 的收货地址和购物车中的图书名称。

```sql

```



4）查询每个用户的用户名和购物车中购买的图书名称，如果没有购物车记录，则显示图书名称为 NULL

```sql

```



5）查询购物车中购买图书数量大于等于2本的用户及其购买的图书名称和购买数量

```mysql

```



6）查询购物车中购买图书价格大于等于50的用户及其购买的图书名称和图书价格

```sql

```



7）查询购物车中有图书的用户的用户姓名、收货人姓名、城市地址和详细地址

```mysql

```



8）请列出购买了价格大于50的图书的用户的收货人姓名、城市地址和电话号码。

```mysql

```



9）查询购买了属于“诗歌”类别的图书的用户的收货人姓名和电话号码

```mysql

```





## 函数

### 1、请根据上述表和数据完成下列操作

1）查询每个用户的注册时间，并将时间转换为年月日格式

```mysql

```



2）查询每本图书的名称和描述，同时将描述截断为前50个字符

```mysql

```



3）查询每个图书的价格，同时将价格取整并添加人民币的货币符号

```mysql

```



4）查询每个用户的购物车中的图书总数

```mysql

```



5）查询购物车中购买图书数量大于等于5本的用户ID和图书数量，如果用户购买图书总数大于等于5本显示“满足条件”，否则显示“不满足条件”

```mysql

```



6）查询id为1的用户的购物车中图书的总价值

```mysql

```



7）查询购物车中购买图书的总金额，同时显示“满100元免运费”或“不满足条件”

```mysql

```



8）请查询出所有书籍的销售情况，统计展示其类别，根据销售数据显示为畅销、一般、滞销三个等级（销量低于2为滞销，不低于2但低于5为一般，不低于5为畅销）

```mysql

```



9）查询每个用户的购物车中图书的平均价格

```mysql

```



10）查询购物车中被购买次数最多的图书,显示购买用户和对应的图书信息

```mysql

```



11）查询每个图书分类下的图书数量和总价格，并按数量降序排序

```mysql

```



12）查询每个图书分类下价格最低的图书名称和价格,没有图书的分类不展示,查询到的结果按照分类id升序排序

```mysql

```





## 子查询

### 1、请根据上述表和数据使用子查询完成下列操作

1）查询购物车中图书价格大于平均价格的图书名称和价格

```mysql

```



2）查询购物车中购买图书数量最多的用户信息

```mysql

```



3）查询购物车中购买图书数量超过5本的用户信息

```mysql

```



4）查询购物车中购买了属于“诗歌”类别的图书的用户信息

```mysql

```



5）查询id为3的用户添加到购物车中的所有书籍的详细信息，包括书籍的名字、书籍的作者、书籍的描述、书籍的出版社以及书籍的价格

```mysql

```



6）请查询和id为3的用户想要购买相同数量以及相同书籍的用户信息，同时显示该书籍的名字以及该书籍的购买数量

```mysql

```



7）请查询和2号用户同一天注册,并且性别相同的用户详细信息,性别展示为男和女

```mysql

```



8）查询购物车中购买图书数量超过各用户购买图书的平均数量的用户信息

```mysql

```



9）查询每个用户购物车中图书价格最高的图书信息（包括图书名称和价格）

```mysql

```




10）请查询出所有书籍的销售情况，统计展示其类别，根据销售数据显示为畅销、一般、滞销三个等级（销量低于2为滞销，不低于2但低于5为一般，不低于5为畅销）

```mysql

```





## 数据操作

> 请已有的estore数据库中执行下列sql语句：

```mysql
-- 订单表
DROP TABLE IF EXISTS `es_order`;
CREATE TABLE `es_order`  (
  `id` int(0) NOT NULL COMMENT '订单编号',
  `user_id` int(0) NULL DEFAULT NULL COMMENT '下单用户',
  `address_id` int(0) NULL DEFAULT NULL COMMENT '收货地址\n',
  `create_date` datetime(0) NULL DEFAULT NULL COMMENT '创建订单时间',
  `pay_way` varchar(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NULL DEFAULT NULL COMMENT '支付方式',
  `tracking_number` int(0) NULL DEFAULT NULL COMMENT '快递单号',
  `distribution_mode` varchar(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NULL DEFAULT NULL COMMENT '配送方式',
  `status` int(0) NULL DEFAULT 1 COMMENT '订单状态\n1.已创建未支付\n2.已支付未发货\n3.已发货未收货\n4.已收货\n5.已关闭 只能关闭 已创建未支付的订单',
  `pay_date` datetime(0) NULL DEFAULT NULL COMMENT '支付时间',
  PRIMARY KEY (`id`) USING BTREE,
  INDEX `es_order_user_id_fk`(`user_id`) USING BTREE,
  INDEX `es_order_address_id_fk`(`address_id`) USING BTREE,
  CONSTRAINT `es_order_address_id_fk` FOREIGN KEY (`address_id`) REFERENCES `es_address` (`id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `es_order_user_id_fk` FOREIGN KEY (`user_id`) REFERENCES `es_user` (`id`) ON DELETE RESTRICT ON UPDATE RESTRICT
) ENGINE = InnoDB CHARACTER SET = utf8mb4 COLLATE = utf8mb4_0900_ai_ci ROW_FORMAT = Dynamic;

SET FOREIGN_KEY_CHECKS = 1;

-- 订单项表
DROP TABLE IF EXISTS `es_order_item`;
CREATE TABLE `es_order_item`  (
  `id` int(0) NOT NULL COMMENT '订单项编号',
  `order_id` int(0) NULL DEFAULT NULL COMMENT '所属订单',
  `book_id` int(0) NULL DEFAULT NULL COMMENT '包含书籍',
  `num` int(0) NULL DEFAULT NULL COMMENT '选购数量',
  PRIMARY KEY (`id`) USING BTREE,
  INDEX `es_order_tiem_order_id_pk`(`order_id`) USING BTREE,
  INDEX `es_order_tiem_book_id_pk`(`book_id`) USING BTREE,
  CONSTRAINT `es_order_tiem_book_id_pk` FOREIGN KEY (`book_id`) REFERENCES `es_book` (`id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `es_order_tiem_order_id_pk` FOREIGN KEY (`order_id`) REFERENCES `es_order` (`id`) ON DELETE RESTRICT ON UPDATE RESTRICT
) ENGINE = InnoDB CHARACTER SET = utf8mb4 COLLATE = utf8mb4_0900_ai_ci ROW_FORMAT = Dynamic;

SET FOREIGN_KEY_CHECKS = 1;
```



### 综合题

小明是一位2023级高考生，现在小明已经得知其已经被杰普大学计算机系录取，为了提前学习到计算机相关的专业知识，他准备在杰普电子商城上购买相关书籍；

1）在进入到杰普商城后，小明发现自己还没有账号，请帮他创建一个账号吧

```mysql

```



2）创建好账号后，小明想要查看商城中都有哪些栏目，以及栏目下各书籍的信息，请帮其查找一下吧

```mysql

```



3）小明发现商城里书籍实在是太多了，看的他眼花缭乱的，他现在想要购买的只有计算机相关的图书，那么如何才能将计算机相关的图书找出来呢？（找出计算机类及其子类的图书）

```mysql

```



4）经过一番查找后，小明终于找到了计算机相关的书籍，但是小明却发现商城管理员将《数据结构与算法》这本书归于了 人工智能这一类别里面，而不是在计算机类这个类别下。小明将这一情况告知了客服，请帮助其将书籍放到合适的类别下吧

```mysql

```



5）几经对比网上关于计算机必读书籍的推荐，小明初步确定了需要购买的书籍为 《计算机网络》、《数据结构与算法》、《操作系统》以及《计算机组成原理》；但是在购买时，发现商城中并没有《操作系统》以及《计算机组成原理》这两本书，于是他联系客服，希望能够上架这两本书。现在需要你帮助商城管理员将这两本书上架，库存各为100本

```mysql

```



6）在客服上架书籍后，小明立马将这几本书添加到了购物车中，请帮助小明将书籍添加到购物车吧

```mysql

```



7）在看到小明为大学专业学习做准备后，同样被计算机专业录用的小刚，希望好朋友小明 利用小明的账号 帮他买一下这些专业书籍；那么如何做到给小刚购买这些书籍呢？

```mysql

```



8）确定好后，小明准备购买书籍，并且书籍寄往家里，请编写SQL语句帮助他完成购买操作吧，假定小明的用户id为1

- 添加小明的收获地址

```mysql

```

- 创建订单，将购物车中的图书生成一条订单记录：

```mysql

```

- 获取刚创建的订单的订单编号：

```mysql

```

- 将购物车中的图书信息添加到订单项表中：

```mysql

```

- 更新图书库存，将购买的图书数量从库存中减去：

```sql

```

- 更新购物车，将购物车中的图书信息删除：

```sql
-- 假设小明的购物车中只有4本书

```





## 数据定义

### 1、软件工程的流程是什么？



### 2、综合题

某公司需要开发一个客户关系管理系统，需要用到以下表：

- 客户表（crm_customer）：
  - id: 客户编号
  - name: 客户姓名
  - phone: 客户联系电话
  - address: 客户地址
- 销售机会表（crm_opportunity）：
  - id: 销售机会编号
  - customer_id: 客户编号，外键 关联到客户表的id
  - activity_id：市场活动编号，外键 关联到市场活动表的id
  - source: 销售机会来源
  - amount: 预计金额
  - close_date: 预计关闭日期
- 联系人表（crm_contact）：
  - id: 联系人编号
  - customer_id: 客户编号，外键 关联到客户表的id
  - name: 联系人姓名
  - title: 联系人职务
  - phone: 联系人电话
- 市场活动表（crm_activities）：
  - id: 市场活动编号
  - name: 活动名称
  - start_date: 活动开始日期
  - end_date: 活动结束日期



其中，一个客户可以有多个销售机会，一个销售机会属于一个客户。一个客户可以有多个联系人，一个联系人属于一个客户。一个市场活动可以有多个销售机会，一个销售机会属于一个市场活动。一个销售机会可以有多个联系人参与，一个联系人可以参与多个销售机会。



请根据以上条件，完成下列需求：

1）请画出其对应的实体-关系图（E-R），`禁止使用Navicat逆向模型`

 

2）请根据上述关系，创建对应的数据库与表

在进行数据库创建和建表操作之前，请先确定数据库的名称。假设我们将数据库命名为`crm`，以下是创建数据库和建表的SQL语句：

- 创建数据库：

```sql

```

- 建表操作：

```sql

```



### 3、综合题2

你好，我是一名刚毕业的大学生，现在入职到了一家IT企业做HR。可是我不懂电脑，你能帮我管理公司的人事档案数据吗？

需求1：公司要求，员工档案要包括以下这些信息：`编号`，`姓名`，`工资`，`生日`

需求2：怎么样？数据库表创建好了？那麻烦你帮我把下面这些数据保存起来吧？

| 姓名   | 工资    | 生日      |
| ------ | ------- | --------- |
| 马云   | 2025.33 | 1973-8-12 |
| 李彦宏 | 3209.49 | 1986-7-14 |
| 马化腾 | 1436.12 | 1964-8-10 |

需求3：呀！对不起，我忘记了，表格中还需要保存“**`手机号`**”！能修改一下表格吗？

需求4：呀！对不起，我又忘记了，公司还需要维护“部门”数据，同时记录每个员工是属于哪个部门的！

需求5：有一位同事辞职了，请帮我把他从系统中删除吧！他的员工编号是：5

需求6：有一位同事涨工资了，涨了200块钱，同时他手机号也改了，新的手机号是：13586705312。请帮我改一下吧，你真是个好人！这位同事的编号是17。

需求7：公司要打印报表，请帮我把全部信息都打印出来吧！

需求8：有同事要补办工牌，请帮我把他的全部信息都调取出来，他的编号是：63

需求9：Linda快过生日了，帮我查一下她生日的具体日期和手机号吧！

需求10：公司要调查薪酬情况，请帮我查询一下工资在2000到5000之间的员工信息，以及工资在3000以上的人数！

需求11：听说有些同事的工资正好是1000、3000或5000，帮我查查他们是谁吧？

需求12：公司开年会，要让名字里有字母o的同事表演节目，帮我查一下吧！

需求13：糟糕，有些同事的手机号是空的，帮我查询一下是哪些人吧！

需求14：市场部的主管想了解他们部门员工的工资，帮我查一下吧！哦，对了，要按顺序显示哦！市场部的部门名称是：Sales

需求15：上述查询返回的记录太多了，查看起来很不方便，怎么样能够实现分页查询呢？

**请使用所学的SQL语句完成以上需求：**

```mysql

```





## 事务控制

### 1、简答题

1）什么是数据库事务？简要描述事务的特性。



2）MySQL如何开启事务操作？



3）请解释数据库事务的提交和回滚操作，以及它们对数据库的影响。



4）什么是事务的隔离级别？列举MYSQL支持的事务隔离级别，并简要描述每个级别的特点。



5）请解释数据库的脏读、不可重复读和幻读问题，并说明这些问题如何通过事务隔离级别解决。





## 索引与视图

### 1、简答题

1）什么是数据库索引？它有什么作用？



2）解释什么是聚集索引和非聚集索引？它们有何区别？



3）什么是唯一索引？它与主键有何区别？



4）什么是复合索引？它在哪些情况下比单列索引更有用？



5）为什么在表的列上创建索引会提高查询性能？



6）列举创建索引的优点和缺点。



7）在何种情况下应该避免创建索引？



8）如何选择在哪些列上创建索引？有哪些因素需要考虑？



9）如何在MySQL中创建索引？列举常见的创建索引语句。



10）如何删除表的索引？列举删除索引的语句。



11） 什么是数据库视图？它的作用是什么？



12） 如何在MySQL中创建视图？列举创建视图的语句。



13） 视图是否占用存储空间？为什么？



14） 视图是否可以被索引？为什么？



15） 视图与表之间有何区别？它们在查询中的使用有何异同？

